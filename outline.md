# Online Stream-Aware Routing in TSN Networks #

## 背景 ##

## 動機 ##

* 為何選擇路由而非排程？
    - 文獻[1-2]指出：優異的路徑規劃可大幅提高可排程的機率並確保應用服務的連續性，因此優先考量TSN路由設計。
* 為何希望做到 stream-aware？
    - 現有的路由機制，往往只考慮`TT`或`AVB`其中一者，而將另一者視為固定不變的參數[2-3]，甚至不做考慮[1]，較容易陷入局部最優解。
    - 將所有資料流都視為可控參數，相當於增加了解空間的選擇，有可能找到更佳的解。
    - 解空間一旦增加，便需要更有效率的方法來比較、篩選不同的解，這也是本算法設計上的挑戰。
* 為何希望做到動態請求？
    - 過往的路由、排程機制往往是離線進行，在生產環境啟動之前進行長時間的計算。
    - 為了處理link falure之類的硬體意外，以及因應工業4.0客制化的需求，需要更動態地調控工廠的網路資源。
    <!-- TODO 加入更形象化的圖文描述 -->
    - 過往的做法主要分為：數學優化工具如 `ILP`，以及元啟發式算法(metaheuristic)如`GRASP`及`禁忌搜索`，但我們認為皆難以符合動態需求，理由將於文獻探討中詳述。

## 文獻探討 ##

### TSN與SDN之異同 ###

### 換程機制 ###

### 路由機制 ###
#### 數學優化方法 ####
過往方法中的輸入、輸出較單純，通常輸入就是網路拓撲及資料流，輸出則是規劃好的路徑。

然而為了加速計算、使之達成動態的要求，我們的算法不可能重新安排每條資料流的路徑，通常要「參考」本來的路徑。這裡所謂參考，例如：盡量不改變舊有資料流的路徑，僅在新資料流排不下時 reroute 部份舊資料流。除了演算速度的考量，也是希望能盡量降低對網路的影響。

這類數學優化工具對每個步驟的規範相對嚴謹，我們無法直接用套用過往的方法來答成前述需求，勢必要重新設計算法。而就我們所知，還沒有看見這方面的文獻。

#### 元啟發式算法 ####
過往所使用的算法，如 GRASP 及禁忌搜索，較有可能直接套用至動態情境（事實上，禁忌搜索該文便有此想法，但並未做進一步研究），然而仍有計算速度的疑慮。

原因是：這兩個方法每次都只會記憶一個全局最佳的解。當新的資料流來到，可能會改變解空間的形狀，先前記憶的這個解可能完全派不上用場，又要從頭開始計算。
<!-- TODO 圖示 -->

當然我們可以稍作修改，例如讓它們記憶前10個最好的解，但隨著解空間的維度增加，這樣的做法仍會面臨瓶頸。

我們選擇的作法也屬於元啟發式算法，但會設法避開上述問題，以期增進計算效率。

## 方法設計 ##

## 實驗流程 ##
為了應證我們的算法是否符合要求，會使用 OMNET++ 這一離散事件模擬工具，測試我們排出的路徑在真實環境是否可行。

然而該工具目前存在一些限制，無法直接在運行時進行 reconfigure，因此我們設計了一套實驗流程。至於更貼近生產環境的實驗，就做為本計劃未來的目標。

### 定義 ###
* `F` - 產線上本來存在的資料流集合
* `F_delete` - 經過一定時間後，從 F 中刪除的資料流集合
* `F_new` - 經過一定時間後，新增至 F 中的資料流集合
* `F'` - 改動之後的資料流集合，即 F ∪ F_new - F_delete
* `Score(R)` - 針對一組路徑規劃 R，我們可以用各項指標（如可排程的數量、平均延遲與 jitter、負載均衡等）為 R 進行評分，得到一個綜合的分數

### 對照組(Routing Optimism/shortest path first) ###
1. 將 `F'` 做為輸入，得到一組路徑規劃 `R_cmp`
3. 記錄計算時間與 `Score(R_cmp)`

### 我們的算法(Stream Aware Routing) ###
1. 將 `F` 做為輸入，得到一組路徑規劃 `R_static`
2. 讓我們的算法進行10秒的 phase 1 演算（摸擬 reconfigure 之前的閒置狀態）
3. 輸入 `F_new` 和 `F_delete`，並參考 `R_static`，得到一組路徑規劃`R_sar`
4. 記錄計算時間與 `Score(R_sar)`

最後比較兩個算法的計算時間及分數。

## Reference ##
[1] E. Schweissguth et al. ``ILP-based joint routing and scheduling for time-triggered networks,’’ In ACM RTNS, pp. 8-17, 2017.
[2] Laursen et al., ``Routing optimization of AVB streams in TSN networks’’ ACM SIGBED Rev., vol. 13, no.4, pp. 1-8, 2016.
[3] N. G. Nayak et al. ``Routing algorithms for IEEE802.1Qbv networks,’’ ACM SIGBED Rev., vol. 15, no. 3 pp. 13-18, 2018.
